L cd %%DBL%% tout60

L curl -k -i -X GET 'https://%%HOST%%/api/?type=keygen&user=%%USER%%&password=%%PASSWORD%%' > tempkey tout60 
# Request Token

L sed -n 's/.*<key>\([^<]*\)<\/key>.*/\1/p'  tempkey > key tout60 
# Parse Key

L curl -k "https://%%HOST%%/api/?type=config&action=get&xpath=/config/devices/entry%5B%40name%3D%27localhost.localdomain%27%5D/deviceconfig/system/ssl-tls-service-profile&key=`cat key`" | tee response tout60 
# response

L xmlstarlet sel -t -v "//ssl-tls-service-profile" -n response V> %%CERT-PROF%% tout60 
# %%CERT-PROF%%

L curl -k "https://%%HOST%%/api/?type=config&action=get&xpath=/config/shared/ssl-tls-service-profile/entry%5B%40name%3D%27%%CERT-PROF%%%27%5D&key=`cat key`" | tee profile tout60 
# profile

L xmlstarlet sel -t -v "//certificate" -n profile V> %%CERT-NAME%% tout60 
# %%CERT-NAME%%

L curl -k "https://%%HOST%%/api/?type=config&action=get&xpath=/config/shared/certificate/entry%5B%40name%3D%27%%CERT-NAME%%%27%5D&key=`cat key`" | tee  certificate tout60 
# certificate

L date +'%Y%m%d' V> %%DATE%% tout60 
# %%DATE%%

L xmlstarlet sel -t -v "//not-valid-after" -n certificate | awk '{print $2 $1 $4}' V> %%TO-DATE%% tout60 
# %%TO-DATE%%

L date +'%Y%m%d' -d "%%TO-DATE%%" V> %%TO-DATE%% tout60 
# %%TO-DATE%%

L xmlstarlet sel -t -v "//not-valid-before" -n certificate | awk '{print $2 $1 $4}' V> %%FROM-DATE%% tout60 
# %%FROM-DATE%%

L date +'%Y%m%d' -d "%%FROM-DATE%%"  | awk {'print 1$0'} V> %%FROM-DATE%% tout60 
# %%FROM-DATE%%

L xmlstarlet sel -t -v "//issuer" -n certificate | awk -F'O[[:space:]]*=[[:space:]]*' '{print $2}' | cut -d',' -f1 V> %%ISSUER_NAME%% tout60 
# %%ISSUER_NAME%%

L xmlstarlet sel -t -v "//algorithm" -n certificate V> %%ENCRYPTION-CIPHER%% tout60 
# %%ENCRYPTION-CIPHER%%

L cd %%DBL%%; ls | grep -v logs | tee /dev/tty | xargs rm -rf profile certificate tout60 
# free up space

L if (%%ENCRYPTION-CIPHER%% notcontains %%DYN_ENCRYPTION%% OR %%SOURCE%% notcontains %%DYN_SOURCE%% OR %%ENCRYPTION-CIPHER%% isempty) echo %%TO-DATE%% < %%DATE%% tout60 
* SUS:stest

L if (%%TO-DATE%% less %%DATE%% OR %%FROM-DATE%% greater %%DATE%% OR %%ENCRYPTION-CIPHER%% notcontains %%DYN_ENCRYPTION%% OR %%DATE%% isempty OR %%SOURCE%% notcontains %%DYN_SOURCE%% OR %%TO-DATE%% isempty OR %%FROM-DATE%% isempty OR %%ENCRYPTION-CIPHER%% isempty OR %%CERT-PROF%% isempty OR %%CERT-NAME%% isempty) echo CIS 1.2.5 Valid certificate is NOT set for browser-based administrator interface : FAIL tout60 
* F:CIS 1.2.5 Valid certificate is NOT set for browser-based administrator interface : FAIL

L if (%%TO-DATE%% greater %%DATE%% AND %%FROM-DATE%% less %%DATE%% AND %%ENCRYPTION-CIPHER%% contains %%ENCRYLEVEL%% AND %%SOURCE%% contains %%TRUSTEDSOURCE%%) echo CIS 1.2.5 Valid certificate is set for browser-based administrator interface : PASS tout60 
* S:CIS 1.2.5 Valid certificate is set for browser-based administrator interface : PASS